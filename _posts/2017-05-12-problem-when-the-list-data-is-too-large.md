---
layout: post
title: Vue 项目上拉加载更多时 list 数据过大导致页面卡顿的问题
category: js
---

### 参考资料

1. [vue-lazy-render: 延迟渲染大组件，增强页面切换流畅度](http://div.io/topic/1894)
2. [Vue.js 一个超长列表无限滚动加载的解决方案](https://github.com/hejianxian/vue-list)
3. [XCel 项目总结 - Electron 与 Vue 的性能优化](https://aotu.io/notes/2016/11/15/xcel/)
4. [无线Web开发经验谈](http://am-team.github.io/amg/dev-exp-doc.html)
5. [记一次惊心动魄的前端性能优化之旅](https://segmentfault.com/a/1190000005147979)
6. [移动H5前端性能优化指南](https://isux.tencent.com/h5-performance.html)

### 背景

最近用vuejs的框架vux开发了一个h5应用，发现一个问题，在手机浏览器查看视频列表页面上拉加载，加载到了300条数据左右的时候，页面开始变得卡了，滚动也不顺畅了，在chrome手机模式下浏览没有这个问题。这是移动端上网页性能的问题，当页面上元素太多就会出现这个问题。当然这个问题不止是Vue的项目才有的，其他框架应该也是存在的。摘录支付宝无线Web解决方案里面提到的：

> 因为在PC上，由于其高性能的硬件，加上强劲的显卡，使得页面渲染的性能非常之高。而在手机上完全不同，有限的硬件性能，加上没有显卡这类专门处理显示的硬件，使得所有页面渲染的工作都由CPU来执行。加上CPU本身的执行频率有限，就会造成页面渲染缓慢。因此在手机上，会发现当页面出现大量的渲染变化的时候，会出现卡顿现象。比如长列表滑动，页面切换动画等等。这些条件都限制了HTML5的功能发挥，因此在涉及到动态变化的时候，更加需要小心处理。

### 网上的解决方案

1. 减少页面元素：当页面滚动停止的时候，删除掉非可见区域的dom，同时保证滚动条高度不变。（此方案理论上可行，我尚未验证）
2. 减少 DOM 操作，每次上拉加载更多的时候，v-for 是通过一条条数据在构建后插入 DOM 的，这对于数据量较大时，无疑会造成严重的性能问题。可以选择自己拼接 HTML 字符串，再通过 innerHTML 一次性插入。
3. GPU 加速：添加 transform: translate3d(0, 0, 0) / translateZ(0) 属性启动 GPU 渲染，缓解滚动会很卡的问题。（这个不好验证，因为还没有办法确认是否已经启用了 GPU 渲染）
4. 缓解路由切换的卡顿情况：让页面切换完成之后才开始渲染数据量大的组件（这个只针对 Vue 的项目）。

此外，建议滚动组件不要使用 iScroll 和 xScroll，在大数据量面前性能表现的不佳。上拉加载更多建议用支持 dom-recycled 的第三方组件，比如 https://github.com/PeachScript/vue-infinite-loading。
